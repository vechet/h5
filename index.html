<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paying to Canadia bank merchant</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-4">
      <div class="mb-5 d-flex flex-column align-items-center">
        <div
          style="width: 50px; height: 50px"
          class="d-flex justify-content-center align-items-center"
        >
          <img
            src="https://marketplace.canva.com/EAFauoQSZtY/1/0/1600w/canva-brown-mascot-lion-free-logo-qJptouniZ0A.jpg"
            class="img-fluid"
            style="max-width: 100%; max-height: 100%; border-radius: 10px"
          />
        </div>
        <p class="text-center mb-0">You're about to pay</p>
        <h5 class="text-center">Canadia bank merchant</h5>
      </div>
      <div class="mb-5 d-flex flex-column align-items-center">
        <div id="div-message" style="display: none">Payment successful</div>
      </div>
      <div id="div-payment" style="display: block">
        <div class="form-group">
          <div class="input-group">
            <input
              type="number"
              class="form-control"
              id="amount"
              name="amount"
              required
              placeholder="Enter amount"
              aria-label="Amount"
              aria-describedby="basic-addon2"
              autofocus
            />
            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon2">$</span>
            </div>
          </div>
        </div>
        <button id="pay" class="btn btn-primary btn-block" disabled>Pay</button>
      </div>
    </div>

    <script>
      //variables
      var amount = document.getElementById("amount").value;
      var userId = "oEd0BwrC72_318e7AnQlzl0hnSYo";
      var appId = "wxdff39e214f645db5";
      var timeStamp = "1712126395";
      var nonceStr = "eVIKoxmtEKg5KOqo7r0QwRim7ZDfglh9";
      var prepayId = "";
      var paySign =
        "bLbYLim6bx5mO+Xb4ZLdPIXLqZr+IwietuR7lMBeapD2N3LKG8R4omXjSnbGRmadzJA80OffI/+rYxb045zl+1EjafkVYWMuHRfqZCtC6EtFr0yPYagU0ZHn++H82W38iRRI6efnPDeVwsTt2uJFDFgPF4HKfxt3och+vNXnsQxxyT5dZX/gN1oCVdNqFt8A+C9+Bidgss6c9Wid4MevQpyj8p3syDPds39P0VAAKnal3/+dkvqUYs7CNuGdV2HrPRHVlzjPsgzxZIqF1JtjWC+FDIZAxZIj7Y74+KAK+wstFHVLYG9jmz5336Gmh41YgYJ+/iuwZdGrKlixpcUFZQ==";

      //validate amount
      document.getElementById("amount").addEventListener("input", () => {
        if (document.getElementById("amount").value > 0) {
          document.getElementById("pay").removeAttribute("disabled");
        } else {
          document.getElementById("pay").setAttribute("disabled", "disabled");
        }
      });

      const onBridgeReady = () => {
        WeixinJSBridge.invoke(
          "getBrandWCPayRequest",
          {
            appId: appId,
            timeStamp: timeStamp,
            nonceStr: nonceStr,
            package: "prepay_id=" + prepayId,
            signType: "RSA",
            paySign: paySign,
          },
          (res) => {
            if (res.err_msg == "get_brand_wcpay_request:ok") {
              //Payment successful
              document.getElementById("div-payment").style.display = "none";
              document.getElementById("div-message").style.display = "block";
            } else if (res.err_msg == "get_brand_wcpay_request:cancel") {
              //Payment cancelled
            } else if (res.err_msg == "get_brand_wcpay_request:fail") {
              //Payment failed
            }
          }
        );
      };

      //submit payment
      document.getElementById("pay").addEventListener("click", () => {
        //create order
        prepayId = OrderPlacementApi(amount, userId);
        if (prepayId == "") {
          return;
        }

        // if (typeof WeixinJSBridge == "undefined") {
        //   if (document.addEventListener) {
        //     document.addEventListener(
        //       "WeixinJSBridgeReady",
        //       onBridgeReady,
        //       false
        //     );
        //   } else if (document.attachEvent) {
        //     document.attachEvent("WeixinJSBridgeReady", onBridgeReady);
        //     document.attachEvent("onWeixinJSBridgeReady", onBridgeReady);
        //   }
        // } else {
        //   onBridgeReady();
        // }
      });

      const OrderPlacementApi = async () => {
        const response = await fetch(
          "https://next-js-quote-app.vercel.app/api/hello2"
        );
        const movies = await response.json();
        console.log(movies);
      };
      // const OrderPlacementApi = (amount, userId) => {
      //   const apiUrl =
      //     "https://apihk.mch.weixin.qq.com/v3/global/transactions/jsapi";
      //   const authToken =
      //     'WECHATPAY2-SHA256-RSA2048 mchid="1487925572",serial_no="3139B59E7F95B5512AF3A788145FA96F172FDF34",nonce_str="0giXXPtmmVil7QdFkUbPqI2vGfnk2dsU",timestamp="1712126971",signature="3iJySTphrAdIJuGAM+U9eK83YB+M+zxwhFCIVe1GR2yb8xD+MJpT6AkfHAspBaWMZUIvyhiH42E2yvWEfPMt/O1C4BTh6ekr/fqy0xrDeo3yNUL4vw29VYN8Q/pl2jTE7bC+NZebqUZ5nc9InQymyU0yq/P1+/UZycwFhjBYe7P/Lp7sNkrD40n8qqtXVMLae76SXTt7yh3sL9JupLHP7oenl68NE7Ca5fBJxdOIFcXFXUe/86RnDUlmYl+mhquESCeUQA3FblbTYRamHCSZeQ+RsaQBn+ilCpAhv6vUsDc3oI3mCZKFs1biRp0B8CUWJ55ZF8UW0+DrBwVah1OnjA=="';
      //   const postData = {
      //     sp_appid: "wxdff39e214f645db5",
      //     sp_mchid: "1487925572",
      //     sub_mchid: "613490525",
      //     out_trade_no: "YX202111100065JSAPI",
      //     merchant_category_code: "5814",
      //     notify_url:
      //       "https://digital.canadiabank.com/cnb/sit/RefundNotification",
      //     trade_type: "JSAPI",
      //     amount: {
      //       total: amount,
      //       currency: "CNY",
      //     },
      //     payer: {
      //       sp_openid: userId,
      //     },
      //     description: "QR code test",
      //   };

      //   const requestOptions = {
      //     method: "POST",
      //     headers: {
      //       "Content-Type": "application/json",
      //       Authorization: authToken,
      //     },
      //     body: JSON.stringify(postData),
      //   };

      //   fetch(apiUrl, requestOptions)
      //     .then((response) => {
      //       return response.json();
      //     })
      //     .then((data) => {
      //       console.log("Data from API:", data);
      //     })
      //     .catch((error) => {
      //       console.error("Error fetching data:", error);
      //     });

      //   return "wx03143945650823c46d6545e03ba3660000";
      // };
    </script>
  </body>
</html>
